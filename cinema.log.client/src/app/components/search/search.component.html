<div class="search-container" data-testid="search-container">
  <div class="search-content" data-testid="search-content">
    <!-- Header Section -->
    <div class="search-header" data-testid="search-header">
      <lord-icon
        src="https://cdn.lordicon.com/wjyqkiew.json"
        trigger="loop"
        delay="2000"
        style="width: 80px; height: 80px"
      >
      </lord-icon>
      <h1 data-testid="search-title">Search for Films</h1>
      <p class="subtitle" data-testid="search-subtitle">Find films to review and rate</p>
    </div>

    <!-- Search Input -->
    <div class="search-input-wrapper" data-testid="search-input-wrapper">
      <p-iconfield iconPosition="left">
        <p-inputicon styleClass="pi pi-search" />
        <input
          id="film-search-input"
          type="text"
          pInputText
          [value]="searchQuery()"
          (input)="searchQuery.set($any($event.target).value); onSearchInput()"
          placeholder="Search for a film by title..."
          class="w-full"
          data-testid="search-input"
        />
      </p-iconfield>
    </div>

    <!-- Loading State -->
    @if (isLoading()) {
      <div class="loading-state" data-testid="search-loading-state">
        <p-card>
          <div class="skeleton-list">
            @for (item of [1, 2, 3, 4]; track item) {
              <div class="skeleton-item">
                <p-skeleton width="100px" height="150px" />
                <div class="skeleton-content">
                  <p-skeleton width="70%" height="1.5rem" />
                  <p-skeleton width="30%" height="1rem" />
                  <p-skeleton width="100%" height="3rem" />
                </div>
              </div>
            }
          </div>
        </p-card>
      </div>
    }

    <!-- Error State -->
    @if (errorMessage() && !isLoading()) {
      <div class="error-state" data-testid="search-error-state">
        <lord-icon
          src="https://cdn.lordicon.com/tdrtiskw.json"
          trigger="loop"
          style="width: 60px; height: 60px"
        >
        </lord-icon>
        <p data-testid="search-error-message">{{ errorMessage() }}</p>
      </div>
    }

    <!-- Search Results with DataView -->
    @if (searchResults().length > 0 && !isLoading()) {
      <div class="search-results" data-testid="search-results">
        <p-dataview #dv [value]="searchResults()" layout="list">
          <ng-template #header>
            <div class="results-header">
              <h2 data-testid="search-results-count">Search Results ({{ searchResults().length }})</h2>
            </div>
          </ng-template>

          <ng-template #list let-films>
            <div class="film-list" data-testid="search-results-list">
              @for (film of films; track film.id; let first = $first) {
                <div
                  class="film-list-item"
                  [ngClass]="{ 'border-top': !first }"
                  (click)="selectFilm(film)"
                  [attr.data-testid]="'search-result-item-' + film.id"
                >
                  <div class="film-poster-compact">
                    @if (film.posterUrl) {
                      <img
                        [src]="getPosterUrl(film.posterUrl, 'w342')"
                        [alt]="film.title"
                        class="poster-image"
                      />
                    } @else {
                      <div class="poster-placeholder-compact">
                        <i class="pi pi-image"></i>
                      </div>
                    }
                  </div>
                  <div class="film-details">
                    <div class="film-title-row">
                      <h3 class="film-title">{{ film.title }}</h3>
                      <span class="film-year">{{ film.releaseYear }}</span>
                    </div>
                    <p class="film-description">{{ film.description }}</p>
                  </div>
                </div>
              }
            </div>
          </ng-template>
        </p-dataview>
      </div>
    }

    <!-- No Search Yet State -->
    @if (!hasSearched() && !isLoading() && searchResults().length === 0) {
      <div class="empty-state" data-testid="search-empty-state">
        <lord-icon
          src="https://cdn.lordicon.com/fpmskzsv.json"
          trigger="loop"
          delay="2000"
          style="width: 100px; height: 100px"
          colors="primary:#D3D3D3"
        >
        </lord-icon>
        <p class="empty-title" data-testid="search-empty-title">Start Your Search</p>
        <p class="empty-subtitle" data-testid="search-empty-subtitle">Type in the search box above to find films</p>
      </div>
    }
  </div>
</div>
